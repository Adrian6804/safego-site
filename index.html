<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SafeGo.ro | RCA Digital</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #050505; color: white; font-family: sans-serif; }
        .btn-neon { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); cursor: pointer; transition: 0.3s; }
        .btn-active { background: #39ff14 !important; color: black !important; box-shadow: 0 0 25px #39ff14; }
        .hidden { display: none; }
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #39ff14; border-radius: 10px; }
        input, select { background: #000 !important; border: 1px solid rgba(255,255,255,0.1) !important; color: white !important; }
    </style>
</head>
<body class="p-6">

    <header class="flex justify-between items-center mb-10">
        <span class="text-2xl font-black italic">SAFEGO<span class="text-[#39ff14]">.RO</span></span>
    </header>

    <div class="grid grid-cols-2 gap-4 mb-10 max-w-md mx-auto">
        <div id="btn-rca" onclick="activateRca()" class="btn-neon p-8 rounded-[32px] flex flex-col items-center">
            <span class="text-3xl mb-3">üöó</span>
            <p class="text-[10px] font-black uppercase">RCA Auto</p>
        </div>
        <div class="btn-neon p-8 rounded-[32px] flex flex-col items-center opacity-20">
            <span class="text-3xl mb-3">‚úàÔ∏è</span>
            <p class="text-[10px] font-black uppercase">Travel</p>
        </div>
    </div>

    <div id="flow-container" class="hidden max-w-lg mx-auto">
        <div id="step-dnt" class="bg-zinc-900/80 p-6 rounded-[32px] border border-white/5">
            <h2 class="text-[#39ff14] font-black text-center mb-6 text-xs uppercase">Analiza Nevoilor (DNT)</h2>
            <div class="space-y-4 max-h-[350px] overflow-y-auto pr-2 custom-scrollbar text-[10px] uppercase font-bold text-zinc-400">
                <div class="p-4 bg-black/40 rounded-2xl">
                    <p class="mb-2">Interesat doar de acest tip de asigurare? *</p>
                    <div class="flex gap-4 text-white"><label><input type="radio" name="q1" value="true" checked> DA</label><label><input type="radio" name="q1" value="false"> NU</label></div>
                </div>
                <div class="p-4 bg-black/40 rounded-2xl">
                    <p class="mb-2">Calitatea dumneavoastrƒÉ: *</p>
                    <div class="flex gap-4 text-white"><label><input type="radio" name="q_qual" value="Proprietar" checked> Proprietar</label><label><input type="radio" name="q_qual" value="Utilizator"> Utilizator</label></div>
                </div>
                <div class="p-4 bg-black/40 rounded-2xl">
                    <p class="mb-2">Utilizare Auto: *</p>
                    <select id="q_usage" class="w-full p-2 rounded-lg mt-1">
                        <option value="Personal">Personal</option>
                        <option value="Taxi">Taxi/Bolt</option>
                    </select>
                </div>
            </div>
            <button onclick="showStepForm()" class="w-full mt-6 py-4 bg-[#39ff14] text-black font-black rounded-2xl text-[10px] uppercase">ContinuƒÉ</button>
        </div>

        <div id="step-form" class="hidden bg-zinc-900/80 p-8 rounded-[32px] border border-white/5">
            <input type="text" id="plate" placeholder="NR. INMATRICULARE" class="w-full p-5 rounded-2xl text-center font-black text-xl mb-4 uppercase">
            <input type="text" id="cnp" placeholder="CNP PROPRIETAR" class="w-full p-5 rounded-2xl text-center font-black text-xl mb-6">
            <button onclick="startV3Process()" class="w-full py-5 bg-[#39ff14] text-black font-black rounded-2xl text-xs uppercase">Ob»õine Oferte</button>
        </div>

        <div id="step-loading" class="hidden py-12 text-center">
            <div class="w-10 h-10 border-4 border-zinc-800 border-t-[#39ff14] rounded-full animate-spin mx-auto mb-4"></div>
            <p class="text-[9px] font-bold uppercase text-[#39ff14]">ValidƒÉm DNT »ôi interogƒÉm serverul...</p>
        </div>

        <div id="step-results" class="hidden space-y-3"></div>
    </div>

<script>
    const API_KEY = '015f40fc-1974-4ad5-bbde-48c117a54307';
    const BASE_URL = 'https://insuretech.staging.insuretech.ro/api/v1';
    const PROXY = "https://api.allorigins.win/raw?url=";

    function activateRca() {
        document.getElementById('btn-rca').classList.add('btn-active');
        document.getElementById('flow-container').classList.remove('hidden');
    }

    function showStepForm() {
        document.getElementById('step-dnt').classList.add('hidden');
        document.getElementById('step-form').classList.remove('hidden');
    }

    async function startV3Process() {
        const cnp = document.getElementById('cnp').value;
        const plate = document.getElementById('plate').value;
        if(!cnp || !plate) return alert("CompleteazƒÉ datele!");

        document.getElementById('step-form').classList.add('hidden');
        document.getElementById('step-loading').classList.remove('hidden');

        try {
            // PASUL A: Trimitere RƒÉspunsuri DNT (OBLIGATORIU pentru deblocare API)
            const dntUrl = `${BASE_URL}/online/client/documents/submit-answers`;
            await fetch(PROXY + encodeURIComponent(dntUrl), {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'X-API-KEY': API_KEY },
                body: JSON.stringify({
                    personBaseRequest: { cif: cnp, legalType: "PF" },
                    formInputData: { 
                        "inputName_1207": document.querySelector('input[name="q1"]:checked').value === "true",
                        "inputName_quality": document.querySelector('input[name="q_qual"]:checked').value,
                        "inputName_usage": document.getElementById('q_usage').value
                    },
                    vendorProductType: "RCA"
                })
            });

            // PASUL B: Cerere Oferte (Acum va func»õiona fƒÉrƒÉ eroarea de API KEY)
            const quoteUrl = `${BASE_URL}/rca/quotes`;
            const res = await fetch(PROXY + encodeURIComponent(quoteUrl), {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'X-API-KEY': API_KEY },
                body: JSON.stringify({ registration_number: plate, owner_id: cnp })
            });
            const data = await res.json();
            renderResults(data.data || []);
        } catch (e) {
            alert("Eroare de procesare. VerificƒÉ dacƒÉ datele introduse sunt reale.");
            document.getElementById('step-loading').classList.add('hidden');
            document.getElementById('step-form').classList.remove('hidden');
        }
    }

    function renderResults(offers) {
        document.getElementById('step-loading').classList.add('hidden');
        const resDiv = document.getElementById('step-results');
        resDiv.classList.remove('hidden');
        resDiv.innerHTML = offers.map(o => `
            <div class="bg-zinc-900 p-6 rounded-2xl border border-white/5 flex justify-between items-center">
                <span class="font-black uppercase text-xs">${o.insurer_name}</span>
                <span class="text-[#39ff14] font-black text-lg">${o.price} RON</span>
            </div>
        `).join('');
    }
</script>
</body>
</html>
