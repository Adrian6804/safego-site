<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SafeGo.ro | RCA Digital</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #050505; color: white; font-family: sans-serif; transition: background 0.3s; }
        .btn-neon { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); cursor: pointer; transition: 0.3s; }
        .btn-active { background: #39ff14 !important; color: black !important; box-shadow: 0 0 25px #39ff14; }
        .hidden { display: none; }
        .page-a4 { background: white; color: black; max-width: 850px; margin: 20px auto; padding: 60px; border-radius: 4px; position: relative; box-shadow: 0 0 30px rgba(0,0,0,0.3); }
        .q-row { border-bottom: 1px solid #f0f0f0; padding: 12px 0; font-size: 13px; line-height: 1.4; }
        .q-title { font-weight: 700; margin-bottom: 6px; display: block; }
        input[type="radio"] { accent-color: #22c55e; margin-right: 5px; }
        .a4-input { border: 1px solid #ddd !important; padding: 12px; border-radius: 6px; width: 100%; margin-top: 5px; font-weight: bold; }
    </style>
</head>
<body class="p-6">

    <div id="view-home">
        <header class="flex justify-between items-center mb-10">
            <span class="text-2xl font-black italic">SAFEGO<span class="text-[#39ff14]">.RO</span></span>
        </header>
        <div class="max-w-md mx-auto grid grid-cols-2 gap-4">
            <div id="btn-rca" onclick="showChoice()" class="btn-neon p-8 rounded-[32px] flex flex-col items-center">
                <span class="text-3xl mb-3">üöó</span>
                <p class="text-[10px] font-black uppercase tracking-widest">RCA Auto</p>
            </div>
            <div class="btn-neon p-8 rounded-[32px] flex flex-col items-center opacity-20">
                <span class="text-3xl mb-3">‚úàÔ∏è</span>
                <p class="text-[10px] font-black uppercase tracking-widest">Travel</p>
            </div>
        </div>
    </div>

    <div id="view-choice" class="hidden max-w-lg mx-auto mt-20 text-center space-y-8 bg-zinc-900/50 p-12 rounded-[40px] border border-white/5">
        <h2 class="text-[#39ff14] font-black text-xs uppercase tracking-[0.2em]">Configurare OfertƒÉ</h2>
        <div class="flex flex-col gap-6">
            <button onclick="openDnt()" class="text-white text-xl font-bold hover:text-[#39ff14] transition">ContinuƒÉ fƒÉrƒÉ consultan»õƒÉ (DNT)</button>
            <button onclick="openContact()" class="text-white text-xl font-bold opacity-40 hover:opacity-100 transition">Vreau consultan»õƒÉ</button>
        </div>
    </div>

    <div id="view-dnt" class="hidden">
        <div class="page-a4">
            <button onclick="processV3()" class="absolute top-10 right-10 bg-[#22c55e] text-white px-8 py-3 rounded-lg font-black text-xs uppercase tracking-wider hover:bg-green-600 shadow-lg">
                SALVEAZƒÇ »òI CONTINUƒÇ
            </button>

            <h1 class="text-2xl font-black border-b-4 border-black pb-4 mb-8">FORMULAR DNT GENERAL</h1>
            <p class="text-[11px] mb-8 text-gray-500 italic">Conform legii, completarea acestui formular este obligatorie pentru emiterea ofertelor RCA.</p>

            <div class="space-y-1">
                <div class="q-row">
                    <span class="q-title">Sunte»õi interesat doar de acest tip de asigurare? *</span>
                    <label><input type="radio" name="q1" checked> DA</label> <label class="ml-6"><input type="radio" name="q1"> NU</label>
                </div>
                <div class="q-row">
                    <span class="q-title">Doresc ofertƒÉ: *</span>
                    <label><input type="radio" name="q2" checked> De la mai mul»õi asigurƒÉtori</label>
                </div>
                <div class="q-row">
                    <span class="q-title">Calitatea dumneavoastrƒÉ: *</span>
                    <label><input type="radio" name="q3" checked> Proprietar</label> <label class="ml-6"><input type="radio" name="q3"> Utilizator</label>
                </div>
                <div class="q-row">
                    <span class="q-title">Auto este utilizat ca: *</span>
                    <div class="grid grid-cols-3 gap-2 mt-2">
                        <label><input type="radio" name="q_usage" checked> Personal</label>
                        <label><input type="radio" name="q_usage"> Taxi/Bolt</label>
                        <label><input type="radio" name="q_usage"> Transport MarfƒÉ</label>
                    </div>
                </div>
                <div class="q-row">
                    <span class="q-title">Ave»õi copii? *</span>
                    <label><input type="radio" name="q4"> DA</label> <label class="ml-6"><input type="radio" name="q4" checked> NU</label>
                </div>
                <div class="q-row">
                    <span class="q-title">Venit lunar din activitatea de: *</span>
                    <div class="grid grid-cols-3 gap-2 mt-2">
                        <label><input type="radio" name="q5" checked> Angajat</label>
                        <label><input type="radio" name="q5"> PFA/Intermediar</label>
                        <label><input type="radio" name="q5"> Altele</label>
                    </div>
                </div>
                <div class="q-row">
                    <span class="q-title">Confirmare Sanc»õiuni Interna»õionale & AML? *</span>
                    <label><input type="radio" name="q6" checked> DA, confirm cƒÉ nu figurez pe liste</label>
                </div>

                <div class="mt-10 p-8 bg-gray-50 rounded-2xl border border-gray-200">
                    <h3 class="font-black text-sm mb-4 uppercase tracking-widest">Identificare Sistem</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <input type="text" id="plate" placeholder="NR. INMATRICULARE" class="a4-input uppercase">
                        <input type="text" id="cnp" placeholder="CNP PROPRIETAR" class="a4-input">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="view-contact" class="hidden">
        <div class="page-a4 text-center">
            <h2 class="text-2xl font-black mb-8">CONTACTEAZƒÇ-NE</h2>
            <div class="max-w-xs mx-auto space-y-4">
                <input type="text" placeholder="Nume" class="a4-input">
                <input type="text" placeholder="Telefon" class="a4-input">
                <button class="w-full bg-black text-white py-4 font-bold rounded-lg">TRIMITE</button>
            </div>
        </div>
    </div>

    <div id="view-results" class="hidden max-w-lg mx-auto space-y-4 mt-10"></div>

<script>
    const API_KEY = '015f40fc-1974-4ad5-bbde-48c117a54307';
    const PROXY = "https://api.allorigins.win/raw?url=";
    const BASE_URL = "https://insuretech.staging.insuretech.ro/api/v1";

    function showChoice() {
        document.getElementById('btn-rca').classList.add('btn-active');
        document.getElementById('view-home').classList.add('hidden');
        document.getElementById('view-choice').classList.remove('hidden');
    }

    function openDnt() {
        document.body.style.backgroundColor = "#f3f4f6";
        document.getElementById('view-choice').classList.add('hidden');
        document.getElementById('view-dnt').classList.remove('hidden');
    }

    function openContact() {
        document.body.style.backgroundColor = "#f3f4f6";
        document.getElementById('view-choice').classList.add('hidden');
        document.getElementById('view-contact').classList.remove('hidden');
    }

    async function processV3() {
        const plate = document.getElementById('plate').value;
        const cnp = document.getElementById('cnp').value;
        if(!plate || !cnp) return alert("CompleteazƒÉ datele de identificare!");

        try {
            // 1. Trimitere obligatorie raspunsuri DNT (Fara asta da eroare API KEY)
            const dntUrl = `${BASE_URL}/online/client/documents/submit-answers`;
            await fetch(PROXY + encodeURIComponent(dntUrl), {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'X-API-KEY': API_KEY },
                body: JSON.stringify({
                    personBaseRequest: { cif: cnp, legalType: "PF" },
                    vendorProductType: "RCA",
                    formInputData: { "dnt_complete": true, "aml_confirmed": true }
                })
            });

            // 2. Cerere Oferte
            const quoteUrl = `${BASE_URL}/rca/quotes`;
            const res = await fetch(PROXY + encodeURIComponent(quoteUrl), {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'X-API-KEY': API_KEY },
                body: JSON.stringify({ registration_number: plate, owner_id: cnp })
            });
            
            const data = await res.json();
            showResults(data.data || []);
        } catch (e) {
            alert("Eroare de comunicare cu serverul Staging.");
        }
    }

    function showResults(offers) {
        document.body.style.backgroundColor = "#050505";
        document.getElementById('view-dnt').classList.add('hidden');
        const resDiv = document.getElementById('view-results');
        resDiv.classList.remove('hidden');
        resDiv.innerHTML = offers.map(o => `
            <div class="bg-zinc-900 p-6 rounded-3xl border border-white/5 flex justify-between items-center">
                <span class="font-black text-xs uppercase">${o.insurer_name}</span>
                <span class="text-[#39ff14] font-black text-xl">${o.price} RON</span>
            </div>
        `).join('');
    }
</script>
</body>
</html>
